= Настроить размещение служебных таблиц

Администратор может настроить место размещения служебных таблиц, используемых сервером {dv} для хранения временных данных: внутренних курсоров, курсоров для работы с файлами и иконками, промежуточных данных представлений, результатов поисковых запросов и прочими.

.В качестве хранилища служебных таблиц могут быть выбраны:
* БД {dv}.
* xref:db-satellite.adoc[Сателлитная] база данных, предназначенная для системных таблиц (`Название-БД-Docsvision_Metadata`).
* База данных `tempdb`.
* https://docs.microsoft.com/ru-ru/sql/relational-databases/in-memory-oltp/in-memory-oltp-in-memory-optimization[Таблица в памяти].

Использование внешних баз данных для хранения служебных таблиц позволяет облегчить обслуживание основной базы {dv}, сократить время на создание её резервных копий и т.п.

.Чтобы настроить размещение служебных таблиц:
* При создании или подключении БД: нажмите на кнопку *Настройки* на странице настройки параметров создания БД.
+
.Кнопка для открытия панели настроек создания и подключения БД
image::openAdvancedConfigButton.png[Кнопка для открытия панели настроек создания и подключения БД]
+
* В параметрах подключенной базы данных: откройте страницу xref:console-db-config.adoc#metadata[Метаданные] настроек БД, и нажмите на кнопку *Настройки*.
+
Будет открыто окно *Настройка генерации скрипта*.
+
.Настройка генерации скрипта
image::changeDbGenScript.png[Настройка генерации скрипта]

.Настройка размещения служебных таблиц осуществляется с помощью следующих параметров:
* `ChangedObjectDataBaseType` -- определяет расположение временных таблиц с изменениями объектов.
* `CursorDataBaseType` -- определяет расположение временных таблиц с внутренними курсорами.
* `FileCursorDataBaseType` -- определяет расположение временных таблиц с файловыми курсорами.
* `IconDataBaseType` -- определяет расположение временных таблиц с иконками.
* `KeysetDataBaseType` -- определяет расположение временных таблиц представлений.
* `SearchDataBaseType` -- определяет расположение временных таблиц с данными поисковых запросов.

Для каждой служебной таблицы можно индивидуально указать место размещения.

.Место размещения может принимать одно из следующих значений:
* *UseDefaultOrCurrent* -- использовать текущее значение или значение по умолчанию.
+
[NOTE]
====
Для новой БД и БД {dv} версии 5.4: таблица с файловыми курсорами будет храниться в собственной БД {dv}, остальные временные таблицы -- в базе данных `tempdb`.
====
+
* *UseOwnDatabase* -- использовать БД {dv}.
* *UseOuterDatabase* -- использовать сателлитную БД, предназначенную для системных таблиц `Название-БД-Docsvision_Metadata`.
+
[NOTE]
====
Если сателлитная БД `Название-БД-Docsvision_Metadata` не используется, она будет создана. Если сателлитная БД не используется, параметр `UseOuterMetadata` должен иметь значение `*False*`.
====
+
* *UseTemparyDatabase* -- использовать временную базу данных `tempdb`.

.Для служебной таблицы "ChangedObjectDataBaseType" также доступны варианты:
* *InMemoryTableOwnDatabase* -- таблица в памяти SQL-сервера.
* *InMemoryTableOwnDatabaseNotPersistData* -- таблица в памяти SQL-сервера без сохранения данных при перезапуске SQL Server.

[NOTE]
====
Если расположение служебных таблиц было изменено после завершения первоначальной настройки {dv}, будет запущена хранимая процедура *ObjectValidation*. Максимальное время выполнения данной процедуры -- `3 часа`.

Если при сохранении возникает ошибка превышения времени ожидания, задайте большее значение на странице xref:console-db-config.adoc#management["Управление"] в параметре `Таймаут`.

При установке значения действует следующее правило: если установлено значение `30 минут` или меньше, для хранимой процедуры *ObjectValidation* действует ограничение -- `3 часа`. В остальных случаях -- используется установленное в параметре `Таймаут` значение. После завершения работы процедуры рекомендуется вернуть для настройки `Таймаут` значение по умолчанию -- `600 секунд`.
====
