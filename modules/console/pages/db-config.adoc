= Настройка базы данных

:page-aliases: admin:console-db-config.adoc

Панель настроек базы данных {dv} -- инструмент Консоли настройки {dv}, который предназначен для настройки БД и параметров {dv}, применяемых при работе с данной БД.

.Панель настроек базы данных {dv}
image::admin:db-properties.png[Панель настроек базы данных {dv}]

[#properties]
== Страница настроек "Свойства"

.Общие сведения о базе данных в Консоли настройки {dv}
image::admin:db-properties.png[Общие сведения о базе данных в Консоли настройки {dv}]

.Страница "Свойства" содержит общую информацию о базе данных:
* Название БД (в СУБД).
* Псевдоним базы данных в {dv}.
* Название сервера баз данных.
* Версия базы данных.
* Дата последнего обновления.
* Признак использования данной БД в качестве xref:db-default.adoc[основной].
* Список используемых сателлитных баз данных.

[#management]
== Страница настроек "Управление"

.Страница настроек "Управление" параметров базы данных {dv}
image::admin:db-management.png[Страница настроек "Управление" параметров базы данных {dv}]

.Страница "Управление" содержит настройки, связанные с обслуживанием базы данных:
. Блок настроек _Корзина_ -- содержит параметры очистки корзины от удалённых (в корзину) карточек:
.. Поле _Не хранить карточки более <> суток_ -- определяет продолжительность нахождения карточки в корзине, по истечении которого задача автоматической или ручной очистки корзины удалит эту карточку.
.. Набор переключателей _Очищать корзину_ -- определяет интервал и время запуска задачи автоматической очистки корзины от карточек, время хранения которых истекло.
.. Кнопка *Очистить* -- удаляет из корзины карточки, время хранения которых истекло.
. Блок настроек _Сценарий обслуживания_ -- предоставляет функциональность запуска пользовательского скрипта обслуживания БД:
.. Поле _Путь к файлу сценария_ -- путь к файлу (`.sql`, `.enc`, `.xml`), содержащему пользовательский код обслуживания БД.
.. Поле _Таймаут_ -- период ожидания завершения скрипта. По истечении указанного интервала выполнение скрипта будет прервано с ошибкой. Также устанавливает максимальное время выполнения процедуры `ObjectValidation`. Процедура `ObjectValidation` запускается, когда изменяется местоположение служебных таблиц в разделе настроек xref:db-config.adoc#metadata[Метаданные].
.. Кнопка *Выполнить* -- запускает выполнение указанного файла сценария.
. Кнопка *Пересоздать задания БД* -- повторно создаёт в БД задания по очистке корзины, удалению записей из системного журнала, архивированию, используется при непреднамеренном удалении заданий из БД, восстановлении БД.
+
Если для заданий в настройках БД установлено время перезапуска, нажатие на данную кнопку сбрасывает время на стандартные значения. Некоторые задания могут влиять на кэш памяти сервера. В связи с этим стоит помнить, что перезапуск *{sss-new}* следует выполнять после выполнения заданий.

[#external-storage]
== Страница настроек "Внешние хранилища"

.Управление внешними хранилищами в Консоли настройки {dv}
image::admin:db-external-storage.png[Управление внешними хранилищами в Консоли настройки {dv}]

.Страница "Внешние хранилища" содержит инструменты для управления хранилищами бинарных данных файлов:
. Блок настроек _Хранилища_ -- список подключенных к {dv} хранилищ бинарных данных.
+
.В списке отображаются:
* Название хранилища.
* Тип места хранения: БД, файловая система, FileStream, другое.
+
[NOTE]
====
При использовании сетевого диска в качестве внешнего хранилища необходимо указывать UNC-адрес.

include::admin:partial$excerpts.adoc[tags=nofs]
====
+
* Состояние хранилища, которое указывает на возможность работы с ним.
* Разделы хранилища -- определяют классы файлов: основные, архивные, временные, данные которых могут сохраняться в хранилище.
+
. Блок настроек _Группы хранилищ_ -- список групп хранилищ и файловых хранилищ, которые входят в данные группы. Группа хранилищ может быть назначена xref:storage-default.adoc[группой по умолчанию] для определённых классов файлов. Группа по умолчанию будет использоваться, когда сервер {dv} не смог определить целевую группу хранилищ по правилам помещения в хранилища. В таком случае классы файлов будут перечислены справа от названия группы.
. Блок настроек _Правила помещения в хранилища_ -- перечень правил, которые определяют способ распределения файлов между группами хранилищ.
+
.В перечне отображаются:
* Название.
* Тип правила, по которому будет проверяться соответствие добавляемого в {dv} файла определённому хранилищу.
* Группа хранилищ, которая будет выбрана для сохранения файла, если выполнены условия правила.
+
Порядок расположения правил в перечне определяет приоритет их применения. Если есть два конкурентных правила, будет выполняться правило с более высоким приоритетом.

[#archiving]
== Страница настроек "Архивирование"

.Настройка архивирования в Консоли настройки {dv}
image::admin:create-panel-archiving.png[Настройка архивирования в Консоли настройки {dv}]

NOTE: Архивирование -- вытеснение редко используемых данных в архивные таблицы базы данных или отдельные базы данных.

.Страница "Архивирование" содержит инструменты для настройки выполнения отложенного архивирования карточек:
. Блок настроек _Расписание_ -- устанавливает расписание запуска задачи архивирования или разархивирования карточек, у которых установлен признак подготовлен к архивации или разархивации.
+
****
Чтобы отключить автоматическое архивирование или разархивирование, установите переключатель в положение *Не архивировать файлы и карточки автоматически*.

В этом случае нужно нажать на кнопку *Выполнить*, чтобы выполнить архивацию или разархивацию отмеченных карточек.

Чтобы настроить задачу архивирования иным образом, установите переключатель в положение *Нестандартное описание архивирования*.

В этом случае нужно самостоятельно настроить в СУБД параметры выполнения задания архивирования с названием *Название БД {dv}_archive*.
****
+
. Кнопка *Выполнить* -- запускает архивирование немедленно.

[WARNING]
====
После архивирования удаление архивных карточек может быть выполнено только пользователями из группы _Операторы архива_.
====

[#metadata]
== Страница настроек "Метаданные"

.Настройка метаданных в Консоли настройки {dv}
image::admin:control-panel-metadata.png[Настройка метаданных в Консоли настройки {dv}]

.Страница "Метаданные" содержит инструменты преобразования динамических метаданных БД в расширенные:
. Кнопка *Преобразовать* -- немедленно преобразует динамические метаданные в расширенные.
+
[WARNING]
====
Перевод БД на расширенные метаданные является необратимым.

Динамические и расширенные метаданные отличаются способом их хранения в БД. Использование расширенных метаданных в большинстве случаев является предпочтительным.
====
+
. Кнопка *Настройки* -- открывает xref:db-service-tables.adoc[панель настройки расположения служебных таблиц].

[#log]
== Страница настроек "Журнал"

.Настройка метаданных в Консоли настройки {dv}
image::admin:control-panel-log.png[Настройка метаданных в Консоли настройки {dv}]

Страница "Журнал" содержит инструменты для управления стратегией журналирования и архивацией журналов работы:

. Набор переключателей _Настройки логирования_ -- определяет общую стратегию журналирования:
* *Логировать все* -- в журнал работы будут попадать все события работы {dv}.
* *Фильтровать лог* -- в журнал работы будут попадать события, выбранные в разделе _Настройки журнала_ в справочнике _Системные настройки_.
* *Логировать только ошибки* -- в журнал работы будут попадать только ошибки {dv}.
. Блок настроек _{pl}_ -- определяет параметры архивирования журнала {pl}.
. Блок настроек _Безопасности_ -- определяет параметры архивирования журнала _Безопасности_.
. Блок настроек _Приложение_ -- определяет параметры архивирования журнала _Приложение_.

.Параметры резервного копирования/очистки журнала
image::admin:log-settings.png[Параметры резервного копирования/очистки журнала]

При нажатии на кнопку image:admin:buttons/three-dots.png[Три точки] в любом блоке настроек появляется окно _Параметры резервного копирования/очистки журнала_. В данном окне можно указать папку для резервных копий в файловой системе. Учётная запись, выполняющая сохранение журналов, должна иметь необходимые права на запись в указанную папку.

[#alwaysOn]
== Страница настроек "AlwaysOn"

.Настройки AlwaysOn в Консоли настройки {dv}
image::admin:always-on-console.png[Настройки AlwaysOn в Консоли настройки {dv}]

На странице "AlwaysOn" настраиваются параметры работы {dv} с группой доступности xref:db-always-on.adoc[AlwaysOn] сервера {mssql}. Данная страница будет скрыта, если база данных не входит в группу доступности AlwaysOn.

.Страница настроек содержит следующие элементы:
. Список _AlwaysOn ноды_ -- ноды, которые включены в AlwaysOn.
. Флаг `*Использовать AlwaysOn*` -- активирует работу сервера {dv} с группами доступности AlwaysOn.
. Флаг `*Использовать SoftPoint*` -- включает использование специальных алгоритмов подключения к узлам AlwaysOn, при использовании программного кластера компании SoftPoint.

[#caching]
== Страница настроек "Настройки кэширования"

.Настройки кэширования в Консоли настройки {dv}
image::admin:create-panel-caching.png[Настройки кэширования в Консоли настройки {dv}]

.Страница "Настройки кэширования" содержит элементы настройки способа хранения временных данных сервера {dv} (серверный кэш):
. Раскрывающийся список *_Провайдер_* -- определяет способ кэширования:
+
--
.. *_InMemory_* -- кэш в памяти (сервера {dv}).
.. *_Redis_* -- кэш в хранилище Redis.
+
NOTE: Кэш-сервер Redis не поддерживает работу в Windows.
+
.. *_NoCache_* -- серверный кэш отключен.
--
+
****
.Способ кэширования выбирается исходя из конфигурации системы {dv}:
* Конфигурация включает только один экземпляр сервера приложений {dv}.
+
Работает служба *{sss-new}*.
+
Может быть выбран *_InMemory_* (предпочтительно) или *_Redis_*.
+
* Конфигурация включает несколько экземпляров сервера приложений {dv}, выполняющихся параллельно.
+
Работает служба *{sss-new}*. Если параметр _Maximum Worker Processes_ в настройках пула приложений {dv} установлен в значение `2` и более, должен быть выбран вариант *_Redis_*. Если организован кластер серверов {dv}, должен быть выбран вариант *_Redis_*.
+
WARNING: Отключать кэширование не рекомендуется так как это может снизить производительность сервера {dv}.
+
[NOTE]
====
Часть данных сервер {dv} кэширует в файловую систему. На расположение таких данных настройка _Провайдер_ не виляет.
====
+
То же актуально и для псевдокластера. Псевдокластер -- это когда на одном сервере работает более 1 экземпляра процесса `{sss-new}`.
// Например, если у пула {sss-new} в IIS установлено более 1 экземпляра (Maximum worker process > 1) или одновременно работает и {sss-new} в IIS, и Windows-служба {sss-new}
+
****
+
. Поле _Строка подключения_ -- строка подключения к Redis.
+
[NOTE]
====
Пример настройки подключения к Redis приведён в пункте xref:redis-cache.adoc[].
====
+
. Флаг `*Включить счетчики производительности*` -- флаг, активирующий функцию записи информации, связанной с работой серверного кэша. Информация записывается в счетчики производительности ОС Windows.

NOTE: Дополнительно ознакомьтесь с информацией в разделе "xref:connection-pool-volume.adoc[]".
