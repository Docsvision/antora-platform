:elastic:

= Подключить полнотекстовый поиск {es}

[WARNING]
====
Лицензия {dv} должна содержать опцию _{dv} Внешний полнотекстовый поиск {es}_, иначе использование системы {es} приведет к ошибке сервера {dv}.
====

. xref:search-elastic.adoc[Установите систему полнотекстового поиска {es}].
include::admin:partial$excerpts.adoc[tags=openFullText]
. Нажмите кнопку *Добавить базу данных*, чтобы открыть окно добавления БД к сервису полнотекстового индексирования.
+
NOTE: Чтобы {es} корректно искал по базе данных {mssql}, в настройках индексации добавьте локаль отличную от нейтральной. Например, русский язык.
+
.Окно добавления БД к сервису полнотекстового индексирования
image::admin:add-db-to-fulltext.png[Окно добавления БД к сервису полнотекстового индексирования]
+
. В списке _Название базы_ выберите подключаемую БД {dv}, установите флаг `*Использовать внешний полнотекстовый поиск ({es})*`. Нажмите *Далее*, чтобы продолжить настройку.
+
В списке отображаются БД, xref:db-settings.adoc[подключенные] к данному серверу {dv}.
+
. Настройте параметры подключения БД к системе полнотекстового поиска.
+
.Окно параметров подключения БД к системе полнотекстового поиска
image::admin:add-db-to-elastic.png[Окно параметров подключения БД к системе полнотекстового поиска]
+
****
.. В поле _{es} url_ укажите адрес системы {es} в следующем формате: `\http://elastic.company.com:9200`.
+
.. Поле _Строка подключения к базе_ содержит неизменяемую строку подключения к БД, которая подключается к сервису полнотекстового индексирования.
.. В поле _Сервер DocsVision_ должна быть указана строка подключения к службе *{sss}* следующего вида: `ConnectAddress=http://company.com/DocsVision/StorageServer/StorageServerService.asmx`.
+
По умолчанию в поле отображается строка подключения к текущему серверу {dv}.
+
[#repeat]
.. Нажмите кнопку *Тест соединений*. Строка подключения будет выделена красным, если подключение не удалось. Если тест завершился с ошибкой, проверьте корректность параметров.
.. Нажмите кнопку *Далее*.
+
NOTE: Если введены неверные данные, кнопка *Далее* будет заблокирована. Исправьте настройки и повторите <<repeat,пункт d>>.
****
+
. В следующем окне настройте параметры индексирования карточек.
+
.Окно настройки параметров индексирования карточек
image::admin:index-cards.png[Окно настройки параметров индексирования карточек]
+
****
.. Установите флаг индексирования у отдельных полей карточек. Типы карточек выбранных полей будут добавлены в список _Индексируемые карточки_.
+
include::admin:partial$excerpts.adoc[tags=cantSelect]
+
.. Если требуется, измените количество https://www.elastic.co/guide/en/elasticsearch/reference/5.5/&#95;basic_concepts.html#getting-started-shards-and-replicas[шардов] (shards) в индексе. Для этого выберите *тип* карточек в списке типов, и измените значение в поле _Количество фрагментов индекса_.
+
Для каждого типа карточек создаётся отдельный индекс. Количество фрагментов в индексе регулируется указанной настройкой.
+
.. Если требуется, включите анализатор текста для полей карточек. Для этого выберите поле карточки в списке карточек, и установите флаг `*Анализировать поле*`.
+
Анализатор -- дополнительный компонент {es}. Анализатор формирует полнотекстовые индексы с учетом морфологии языка.
+
Также при выборе поля карточки, справа отобразится информация о поле:
+
* _Тип поля_.
* _Доступно для индексирования_ -- по полю может быть выполнен поиск.
+
[#deleteSource]
.. Установите флаг `*Удалять первичные данные файлов после обработки*`, чтобы индексируемые файлы автоматически удалялись из базы {es}.
+
.В {es} существует два набора данных:
* RawContent -- исходные данные файлов, переданные из {dv}.
+
Исходные данные не используются в поиске, по ним формируются обработанные данные (CleanContent).
+
* CleanContent -- обработанные данные, сформированные из RawContent.
+
Обработанные данные используются в полнотекстовом поиске.
+
Если флаг `*Удалять первичные данные файлов после обработки*` активен, данные RawContent будут автоматически удаляться после формирования данных CleanContent.
+
.. Нажмите кнопку *Далее*.
****
+
. В следующем окне настройте параметры индексирования справочников.
+
.Окно настройки параметров индексирования справочников
image::admin:index-directories.png[Окно настройки параметров индексирования справочников]
+
****
.. Установите флаг индексирования у отдельных полей справочников.
+
include::admin:partial$excerpts.adoc[tags=cantSelect]
+
Для поля, содержащего данные сложного вида, например, _Номер_ необходимо активировать флаг `*Анализировать поле*`. При установленном флаге используется сложный анализатор со словарями. При снятом флаге используется простой анализатор, который разбивает текст пробелами и переводит в нижний регистр. Если анализатор выключен, будет срабатывать нечёткий поиск.
+
.Особенности индексирования данных сложного вида
image::admin:indexing-elastic.png[Особенности индексирования данных сложного вида]
+
.. Нажмите кнопку *Далее*.
****
+
. Нажмите *Завершить*, чтобы подключить БД к сервису полнотекстового индексирования с текущими настройками.
+
****
База данных будут добавлена в список баз данных, использующих сервис полнотекстового индексирования.
****
+
. Включите индексирование добавленной базы данных.
+
include::admin:partial$indexingProperties.adoc[]
+
. Настройте свойства индексирования {es} согласно инструкции в разделе xref:search-elastic-change.adoc[].
