:storageorgroup:

= Подключить внешнее хранилище

[WARNING]
====
Для работы с некоторыми типами внешних хранилищ нужна дополнительная лицензионная опция. Подробная информация приведена ниже.
====

== Подключение хранилища

WARNING: При работе с БД PostgreSQL поддерживаются не все типы хранилищ.

.Чтобы подключить внешнее хранилище:
include::admin:partial$excerpts.adoc[tags=openStorages]
+
.Окно "Настройки хранилища"
image::admin:create-storage.png[Окно настройки хранилища]
+
. Настройте параметры добавляемого хранилища:
[lowerroman]
.. В поле _Название_ введите уникальное имя для нового хранилища.
.. В списке _Тип_ выберите тип подключаемого хранилища.
+
****
* *_Хранилище на диске_*. Если данные будут храниться в файловой системе сервера {dv}.
* *_Хранилище во внешней базе Microsoft SQL Server_*. Если данные будут храниться в БД Microsoft SQL Server, не являющейся используемой БД {dv}.
* *_FileStream хранилище во внешней базе данных Microsoft SQL Server_*. Если данные будут храниться в FileStream базы данных Microsoft SQL Server, которая не является текущей БД {dv}.
* *_Filestream хранилище в базе данных {dv}_*. Если данные будут храниться в FileStream текущей базы данных {dv}.
+
[WARNING]
====
include::admin:partial$excerpts.adoc[tags=nofs]
====
+
*Только для СУБД Microsoft SQL Server*.
+
* *_Добавить из сборки…_*. Если данные будут храниться в хранилище, тип которого предоставляется выбранным компонентом (файл `.dll`).
+
Инструкция по разработке программного компонента для работы с хранилищем приведена в документации разработчика _{dv}_, в разделе "xref:programmer:external-storages:external-storages-develop.adoc[]".
+
[WARNING]
====
Типы хранилищ *_Хранилище во внешней базе Microsoft SQL Server_*, *_FileStream хранилище во внешней базе данных Microsoft SQL Server_* и *_Filestream хранилище в базе данных {dv}_* доступны только если БД {dv} работает под управлением Microsoft SQL Server.

При использовании хранилищ *_FileStream хранилище во внешней базе данных Microsoft SQL Server_* и *_Filestream хранилище в базе данных {dv}_* учетным записям сервера {dv} и файлового сервиса нужен полный доступ на папку FileStream.

include::admin:partial$excerpts.adoc[tags=nofs]
====
+
include::admin:partial$excerpts.adoc[tags=storageLimits]
+
* Помимо перечисленных типов хранилищ, в {dv} также есть тип "Хранилище в базе данных {dv}". Хранилище с данным типом по умолчанию подключено, используется и не может быть создано или удалено.

.Для работы с внешними хранилищами лицензия {dv} должна содержать опцию:
* _{dv} Внешнее хранилище ФС_, чтобы использовать *_Хранилище на диске_*.
* _{dv} Внешнее хранилище MSSQL_, чтобы использовать *_Хранилище во внешней базе Microsoft SQL Server_*.
* _{dv} Внешнее хранилище FileStream_, чтобы использовать *_FileStream хранилище во внешней базе данных Microsoft SQL Server_*.
* _{dv} Внешние файловые хранилища_, чтобы использовать внешние хранилища и вариант *_Добавить из сборки…_*.
+
[WARNING]
====
Для использования собственного типа хранилищ *_Добавить из сборки…_* в лицензии {dv} должна присутствовать функция _{dv} модуль интеграции с произвольными файловыми хранилищами (F91DB4AB-6E40-4D04-97BB-EBABF15E1562)_.

Подключение к серверу {dv} с настроенным внешним хранилищем без соответствующей лицензионной опции завершится ошибкой.

include::admin:partial$excerpts.adoc[tags=nofs]
====
****
+
.. В списке `Состояние` выберите тип подключаемого хранилища.
+
****
* *_Online_* -- стандартное состояние, при котором хранилище доступно на чтение, запись и удаление.
* *_Auto_* -- состояние, при котором хранилище будет автоматически переведено в режим "только чтение и удаление" при достижении размера, указанного в настройке _Макс. размер (Гбайт)_.
* *_Disabled_* -- хранилище отключено, операции чтения, записи и удаления будут недоступны.
+
Файлы, бинарные данные которых хранятся в хранилище с состоянием *_Disabled_*, также будут недоступны.
+
[NOTE]
====
Переведите хранилища в состояние *_Disabled_* на время проведения профилактических работ по обслуживанию хранилища.
====
+
* *_Read and Delete_* -- состояние, при котором хранилище доступно только на чтение и удаление данных.
* *_Reserved_* -- состояние, при котором хранилище не используется, пока в его группе хранилищ не заполнены остальные хранилища. Данное хранилище будет задействовано после заполнения других хранилищ группы.
****
+
.. Если для хранилища установлено состояние *_Auto_*, укажите в поле _Макс. размер (Гбайт)_ максимальный размер хранилища, при достижении которого оно будет переведено в режим "только чтение и удаление".
+
****
Если состояние хранилища не *_Auto_*, данная настройка не используется.

При значении по умолчанию `0 Гб` автоматическое переключение режима хранилища осуществляться не будет.

[NOTE]
====
Информация о загруженности хранилища обновляется каждые 10 минут.
====

Если хранилище включено в xref:storage-default.adoc[группу хранилищ по умолчанию], ограничение _Макс. размер (Гбайт)_ игнорируется. Если для файла не найдено других хранилищ, подходящих по правилам помещения, файл будет сохранён в хранилище из группы хранилищ по умолчанию.
****
+
.. В блоке настроек _Разделы_ установите необходимые флаги.
+
****
* `*Основной*`. Если хранилище может быть использовано для хранения бинарных данных актуальных файлов.
* `*Архивный*`. Если хранилище может быть использовано для хранения бинарных данных файлов карточек, помещённых в архив.
* `*Временный*`. Если хранилище может быть использовано для хранения временных бинарных данных.
+
Временное хранилище используется для временного накопления бинарных данных файлов при их добавлении в {dv}. После завершения накопления файл будет перемещен из `*Временного*` в `*Основное*` хранилище.
+
[WARNING]
====
Рекомендуется устанавливать флаг `*Временный*` для всех типов хранилищ, за исключением хранилищ в БД Microsoft SQL.
====
****
+
.. В блоке настроек _Свойства_ укажите дополнительные настройки хранилища.
+
****
.Для типа "Хранилище на диске":
* _Путь_ -- расположение каталога в файловой системе для сохранения бинарных данных файлов.

.Для типа "Хранилище во внешней базе Microsoft SQL Server":
* _Строка соединения_ -- строка соединения с БД в формате
include::admin:partial$excerpts.adoc[tags=connectionLine]
+
* _Таймаут (с)_ -- время ожидания ответа от сервера в секундах.

.Для типа "FileStream хранилище во внешней базе данных Microsoft SQL Server":
* _Строка соединения_ -- строка соединения с БД в формате
include::admin:partial$excerpts.adoc[tags=connectionLine]
+
* `Папка` -- расположение каталога на сервере СУБД для бинарных данных файлов, вытесняемых FileStream.
* `Таймаут (с)` -- время ожидания ответа от сервера в секундах.

.Для типа "Filestream хранилище в базе данных {dv}":
* `Папка` -- расположение каталога для вытесняемых в FileStream бинарных данных файлов на сервере СУБД Microsoft SQL Server.

.Для типа "Добавить из сборки…":
* Список дополнительных параметров определяется собственной реализацией типа хранилища.
****
+
. Нажмите на кнопку *ОК*, чтобы добавить хранилище в список.
+
****
include::admin:partial$excerpts.adoc[tags=tenMin]
****
+
. xref:storage-add-to-group.adoc[Включите хранилище в группу хранилищ].

== Изменение настроек хранилища

.Чтобы изменить настройки хранилища:
. Выберите его в списке _Хранилища_ и нажмите на кнопку image:admin:buttons/notepad-pencil.png[Блокнот с карандашом].
+
Тип хранилища не может быть изменён.

include::admin:partial$deleteStorage.adoc[]
