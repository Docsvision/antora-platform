= Справочник компонентов

_Справочник компонентов_ является хранилищем программных компонентов, которые могут быть по запросу установлены на компьютер пользователя {dv}. Компоненты устанавливаются автоматически при необходимости при запуске {wincl}. Если необходимые {wincl}у компоненты отсутствуют на компьютере пользователя, и загружены в хранилище программных компонентов (_Справочник компонентов_), они будут загружены автоматически.

_Справочник компонентов_ обладает встроенной системой учета версий, которая обеспечивает возможность автоматического обновления компонентов, установленных на компьютеры пользователей.

Компоненты, загруженные в _Справочник компонентов_, объединяются в группы. Принцип формирования групп определяет инженер {dv}.

_Справочник компонентов_ предназначен для распространения только .NET-сборок.

== Открытие Справочника компонентов

.Чтобы открыть главное окно справочника:
. Запустите {wincl} от имени администратора {dv}.
. Откройте элемент menu:Конструкторы и справочники[Справочник компонентов].

== Принцип работы механизма распространения компонентов

. Пользователь выполняет операцию, которая требует использования внешнего компонента.
+
****
Например, когда пользователь запускает {wincl}, к которому подключено расширение, или открывает карточку, к скрипту которой подключена библиотека DLL.
****
+
. {wincl} пытается получить необходимый компонент из файловой системы компьютера пользователя стандартным путём. Например, из каталога программы, GAC или из каталога распространяемых компонентов: `%temp%\DV5.5\Deploy\`.
+
.Механизм распространения компонентов
[plantuml, svg]
....
@startuml
'!pragma layout elk
skinparam rectangleBorderThickness 1
skinparam defaultTextAlignment center
skinparam lifelineStrategy solid
skinparam monochrome true

State "Поиск компонентов по \nстандартным путям" as base
State "Файл не найден" as notfound
State "Файл найден" as found
State "Новая версия" as changed
State "Старая версия" as notchanged
State "Файл в Справочнике компонентов" as checkdir
State "Компонент" as componentreg
State "Действие" as componentnreg

base -> notfound : Файлы компонентов не найдены
base --> found : Файлы компонентов найдены
found --> changed : Версия изменилась
found --> notchanged : Версия не изменилась
notfound --> checkdir : Проверка в справочнике
checkdir --> componentreg : Компонент зарегистрирован
checkdir --> componentnreg : Компонент не зарегистрирован

base: В каталоге программы, GAC или \nв каталоге распространяемых \nкомпонентов.

notfound: Механизм распространения \nкомпонентов не используется.
found: Проверяется версия группы, \nв файле описания.

changed: Возвращается и загружается \nновая версия компонента \nиз Справочника компонентов.
notchanged: Возвращается данный компонент.

checkdir: Проверяется наличие файла.

componentreg: Загружается на компьютер пользователя. \nВозвращается загруженная версия компонента.

componentnreg: Выполняется предусмотренное \nпрограммой действие. \nНапример, возвращается ошибка.

@enduml
....

* Если файл не найден по стандартным путям, механизм распространения компонентов не используется.
* Если файл найден в каталоге распространяемых компонентов, проверяется версия его группы, указанная в файле описания: `%temp%\DV5.5\Deploy\Группа-компонентов\group.info`.
** Если версия группы компонентов не изменилась, возвращается данный компонент.
** Если версия группы компонентов изменилась, проверяется версия компонента, которая указана в папке компонента: `%temp%\DV5.5\Deploy\Группа-компонентов\Название-компонента_Версия-компонента`.
*** Если версия компонента не изменилась, возвращается данный компонент.
*** Если версия компонента изменилась, из _Справочника компонентов_ загружается новая версия; возвращается новая версия компонента.
* Если файл не найден, проверяется его наличие в _Справочнике компонентов_.
** Если компонент с искомым названием (например, Cia.MessControl.dll) зарегистрирован в _Справочнике компонентов_, он загружается на компьютер пользователя в папку `%temp%\DV5.5\Deploy\[Группа компонентов]\[Название компонента]_[Версия компонента]`; возвращается загруженная версия компонента.
** Если компонент не зарегистрирован в _Справочнике компонентов_, выполняется предусмотренное программой действие (например, возвращается ошибка).
+
[WARNING]
====
Загруженные из _Справочника компонентов_ файлы хранятся в каталоге `%temp%\DV5.5\Deploy\Группа-компонентов\Название-компонента_Версия-компонента`.

Данную особенность необходимо учитывать при подключении компонентов к {wincl}у, если компоненты подключаются с указанием полного пути.
====

== Интерфейс Справочника компонентов

Ниже представлено главное окно _Справочника компонентов_.

.Главное окно Справочника компонентов
image::components-window.png[Главное окно Справочника компонентов]

.Главное окно _Справочника компонентов_ содержит:
Панель инструментов с кнопками::
image:buttons/save-components-directory.png[Дискета]

Сохранить:::
Сохраняет настройки _Справочника компонентов_;
image:buttons/add-components-group.png[Скобки с плюсом]

Добавить группу:::
Добавляет новую группу компонентов;
image:buttons/remove-components-group.png[Скобки с минусом]

Удалить группу:::
Удаляет выбранную группу компонентов;
image:buttons/add-components-to-group.png[Страница с плюсом]

Добавить компонент:::
Добавляет компоненты в выбранную группу компонентов;
image:buttons/remove-component-from-group.png[Страница с минусом]

Удалить компонент:::
Удаляет выбранный компонент из группы компонентов;

Список групп компонентов::
Описание группы компонентов -- содержит информацию о выбранной группе.

Иконка группы:::
Отображается только в справочнике.

Название группы:::
Имя группы.

Дополнительное описание:::
Дополнительная информация о группе.

Текущая версия группы компонентов:::
Номер автоматически увеличивается при изменении группы.

Список файлов группы:::
Содержит информацию о компонентах, включённых в группу.

Название файла::::
Имя файла.

Версия файла::::
Версия файла.

Даты создания и изменения::::
Когда файл был создан или изменён.
